/**
 * @author        Jose Ortiz Costa
 * @application   com.joeddev.rsace
 * @File          Developer.java
 * @Date          04/06/2015
 * @Description   This singleton class extends TreeWritter, and 
 *                handle all the data related to the developers
 *                using this application
 */

package com.jocdev.rsace.appTree;
import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import javax.xml.parsers.ParserConfigurationException;
import org.eclipse.core.resources.IFile;
import org.eclipse.core.resources.IResource;
import org.eclipse.core.runtime.CoreException;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;
public class Developer extends TreeWriter
{
    private IFile file;
    private String id;
    private String name;
    private String email;
    private boolean active;
    private boolean isTheSender;
    
    /**
     * @category Constructor
     */
    public Developer () 
    {
        super();
        file = getFile(TreeBuilder.CONFIG_DIR, ConfigBuilder.TEAM_FILE_CONFIG);
    }
    
    /**
     * @category           Constructor
     * @param id           String object representing the developer's id
     * @param name         String object representing the developer's name or userName
     * @param email        String object representing the developer's email
     * @param isActive     boolean representing true if the session for this developer is 
     *                     active.
     * @param isTheOwner   boolean representing true if the developer is the owner of this
     *                     session
     */
    public Developer (String id, String name, String email, boolean isActive, boolean isTheOwner) 
    {
        super();
        file = getFile(TreeBuilder.CONFIG_DIR, ConfigBuilder.TEAM_FILE_CONFIG);
        this.id = id;
        this.name = name;
        this.email = email;
        this.active = isActive;
        this.isTheSender = isTheOwner;
    }
    
    /**
     * @category     Public Class Method
     * @description  Sets the developer's id
     * @param id     String object representing the developer's id
    */
    public void setId (String id)
    {
       this.id = id;
    }
    
    /**
     * @category     Public Class Method
     * @description  Sets the developer's name
     * @param name     String object representing the developer's name
    */
    public void setName (String name)
    {
       this.name = name;
    }
    
    /**
     * @category     Public Class Method
     * @description  Sets the developer's email
     * @param email    String object representing the developer's email
    */
    public void setEmail (String email)
    {
       this.email = email;
    }
    
    /**
     * @category           Public Class Method
     * @description        Sets this developer as the session's owner
     * @param isSender     boolean object. When true, it sets this developer as the session owner
    */
    public void setAsSender (boolean isSender)
    {
        this.isTheSender = isSender;
    }
    
    /**
     * @category           Public Class Method
     * @description        Sets this session as active for this developer
     * @param isActive     boolean object. When true, session is active
    */
    public void setActive (boolean isActive)
    {
        this.active = isActive;
    }
    
    /**
     * 
     * @return
     */
    public String getId ()
    {
        return id;
    }
    public String getName ()
    {
        return name;
    }
    
    public String getEmail ()
    {
        return email;
    }
    
    public boolean isSender ()
    {
        return isTheSender;
    }
    
    public boolean isActive ()
    {
        return active;
    }
    
   
    
    private void prepareDeveloperInfo (Element root, Document document)
    {
       
        Element developer =  createElement (document, root, "developer");
        setAtrribute(document, developer, "id", getId());
        setChildNode(document, developer, "name", getName());
        setChildNode(document, developer, "email", getEmail());
        setChildNode(document, developer, "session_active", String.valueOf(isActive()));
        setChildNode(document, developer, "session_owner", String.valueOf(isSender()));
        
    }
    
    public void setAsSessionOwner () throws ParserConfigurationException, CoreException
    {
        Document document = getNewDocument(file);
        Element root = createRoot(document, "developers_team", 
                                  "http://jocdev.com/Rsace/ConfigFiles/developers",
                                  "DO NOT EDIT THIS FILE MANUALLY. You can safely edit this file from your rsace's preferences");
        prepareDeveloperInfo( root, document);
        InputStream is = getStream(file, document);
        file.setContents(is, IResource.NONE, null);
        
    }
    
    public void addToTeam () throws SAXException, IOException, CoreException, ParserConfigurationException
    {
        Document document = getDocumentToParse(file);
        document.getDocumentElement().normalize();
        Element root = document.getDocumentElement();
        prepareDeveloperInfo( root, document);
        InputStream is = getStream(file, document);
        file.setContents(is, IResource.NONE, null);
    }
    
    // Get it to work
    public ArrayList <Developer> getDevelopersInTeam ()
    {
        try
        { 
           String id, name, email;
           boolean isActive, isSender;
           Document document = getDocumentToParse(file);
           document.getDocumentElement().normalize();
           NodeList nList = document.getElementsByTagName("developer");
           ArrayList <Developer> developers = new ArrayList<>();
           
           for (int i = 0; i<nList.getLength(); i++)
           {
        	   
               Node nNode = nList.item(i);
               if (nNode.getNodeType() == Node.ELEMENT_NODE) 
               {
            	   
                   Element eElement = (Element) nNode;
                   id = eElement.getAttribute("id");
                   name = eElement.getElementsByTagName("name").item(0).getTextContent();
                   email = eElement.getElementsByTagName("email").item(0).getTextContent();
                   isActive = Boolean.valueOf(eElement.getElementsByTagName("session_active").item(0).getTextContent());
                   isSender = Boolean.valueOf(eElement.getElementsByTagName("session_owner").item(0).getTextContent());
                   developers.add(new Developer(id,name,email,isActive,isSender));
                   
               }
               
           }
           return developers;
        }
        catch (Exception e)
        {
            
        }
        return null;
    }
    
    public Developer getDeveloperFromTeamByName (String name)
    {
        
        for (Developer dev : getDevelopersInTeam())
            if (dev.getName().equalsIgnoreCase(name))
                return dev;
        return null;
    }
    
    public Developer getDeveloperFromTeamById (String id)
    {
       for (Developer dev : getDevelopersInTeam())
            if (dev.getId().equalsIgnoreCase(id))
                return dev;
        return null;
    }
   
}
